<!DOCTYPE html>
<html>
<head>
<title>EVEN CHOP calculator for poker MTTs (after first 5% to Chip Leader)</title>
<script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>
<body class="m-2">
<div id="root"></div>

<script type="text/babel">

const EXAMPLE_DATA = ["1023", "570", "250", "180", ""]; // Pool: $2023 , Even: $480 x 4 ( = 1920 total ) + $101 CL

const FOCUS_DELAY_DEFAULT = 4;
const FOCUS_DELAY_SECONDARY = FOCUS_DELAY_DEFAULT + 50;

const LABEL_INSERT = "Insert new place at top of list";
const LABEL_INPUT = index => `Payout for ${ordinal(index + 1)} place`;
const LABEL_REMOVE = index => `Remove ${ordinal(index + 1)} place`;
const LABEL_APPEND = "Add new place to bottom of list";

const APP_KEY = "prize-pool-chop-minus-5%";

const zero_our = (_ = [
  'The Beatles made an "off by one error"; `0` is actually the loneliest number.',
  'Welcome to "ground zero"; have a `blast` doing nothing!',
  'Puns about `0` are like #DadJokes that earn zero Internet Points. But, gottacatchemall eh?',
  "An even chop of nothing is, hmmm, let's see, nothing divided by nothing, carry the `0`...",
  'From Hero To `Zero`. Are you one of those people that just want to watch the world burn?',
  'There are `zero` other "funny" sayings to discover. Stop wasting time!',
]) => _[Math.floor(Math.random() * _.length)]; // more accurate than this terser test: ]) => _[ (+new Date) % _.length ];

const ordinal = num => `${num}${[, "st", "nd", "rd"][ (num % 100 < 11 || num % 100 > 13) && (num % 10) ] || "th"}`;

const loadedPlaces = JSON.parse(localStorage.getItem(APP_KEY)) || [];

const App = () => {

  const [places, setPlaces] = React.useState(
  	loadedPlaces.some(Boolean) ? loadedPlaces : EXAMPLE_DATA
  );

  const inputRefs = React.useRef([]);

  const zero = zero_our().split("`");

  const focusIndex = (index, delay) => setTimeout( () => inputRefs.current[index]?.focus(), delay || FOCUS_DELAY_DEFAULT );

  const insertNewPlace = () => {
    focusIndex(0, FOCUS_DELAY_SECONDARY);
    setPlaces(["", ...places]);
  };

  const removePlace = (index) => {
    const newPlaces = [...places];
    newPlaces.splice(index, 1);
    focusIndex(index, FOCUS_DELAY_SECONDARY);
    setPlaces(newPlaces);
  };

  const appendNewPlace = () => {
    focusIndex(places.length, FOCUS_DELAY_SECONDARY);
    setPlaces([...places, ""]);
  };

  const updatePlace = (index, value) => {
    const newPlaces = [...places];
    newPlaces[index] = value <= 0 ? 0 : Number(value);
    focusIndex(index, FOCUS_DELAY_SECONDARY);
    setPlaces(newPlaces);
  };

  React.useEffect(() => {
    localStorage.setItem(APP_KEY, JSON.stringify(places));
    // focusIndex(places.length - 1);
    // focusIndex(0);
  }, [places]);

  const totalPrizePool = places
    .filter(value => value > 0)
    .reduce((a, c) => a + Number(c), 0);

  const CL_PERCENT = 5.0;
  
  const percentLink = () => (
    <a
      href="#"
    >
      {CL_PERCENT.toFixed(1)}%
    </a>
  );

  const bonus = Math.floor(totalPrizePool * ( CL_PERCENT / 100 ) );

  const remaining = totalPrizePool - bonus;

  const count = places.filter(value => value > 0).length;

  const chopValue = count ? Math.floor(remaining / count) : NaN;

  const chopTotal = count ? (chopValue * count) : NaN;
  
  return (
    <div>

      <button
        className="btn btn-info mb-3"
        style={{ width: '10em' }}
        onClick={() => insertNewPlace()}
        role="button"
        aria-label={LABEL_INSERT}
        title={LABEL_INSERT}
      >Insert Place</button>

      {
        places.length
        ? places.map( (place, index) => {

          // return ( <div key={index} style={{ display: 'flex', marginBottom: '10px', alignItems: 'center' }}>
          return ( <div key={index}
              className="d-flex align-items-center mb-2"
          >
            
            <label
              style={{ display: 'flex', alignItems: 'center' }}
            >
              <span
                style={{ minWidth: '2em', textAlign: 'right' }}
                className="mr-1"
              >
                {ordinal(index+1)}
              </span>

              <input
                type="number" step="10"
                className="form-control ml-1 mr-2"
                style={{ width: '7.5em' }}
                value={place || ''} 
                onChange={({ target: { value } }) => updatePlace(index, value)}  
                ref={el => inputRefs.current[index] = el}
                aria-label={LABEL_INPUT(index)}
                title={LABEL_INPUT(index)}
              />

              <button
                // style={{ height: '20px', marginLeft: '10px' }}
                className="btn btn-danger btn-sm"
                onClick={() => removePlace(index)}
                role="button"
                aria-label={LABEL_REMOVE(index)}
                title={LABEL_REMOVE(index)}
              >X</button>
            </label>
          </div> );

        } )
        : <div className="mb-1 text-muted"><small> ~ {zero[0]}<b>{zero[1]}</b>{zero[2]} ~ </small></div>
      }

      <button
        className="btn btn-primary mb-1"
        style={{ width: '10em' }}
        onClick={() => appendNewPlace()}
        role="button"
        ariaLabel={LABEL_APPEND}
        title={LABEL_APPEND}
      >Add Place</button>

      <div
        className="mt-3"
      >
        <strong>Prize Pool:</strong> {totalPrizePool > 0 ? `$${totalPrizePool}` : ''}
      </div>

      <div
        className="mt-2"
      >
        Even Chop: {
          chopValue > 0
          ? <span><strong>${chopValue}</strong> x {count} ( = ${chopTotal} total )</span>
          : ''
        }
      </div>

      {totalPrizePool > 0 && <div>( after first giving {percentLink()} to <strong>Chip Leader{bonus > 0 ? `: $${bonus}` : ''}</strong> )</div>}

    </div>
  );
};

ReactDOM.render(<App />, document.querySelector('#root'));

</script>
</body>
</html>
